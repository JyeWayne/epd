[SYSTIME]
PARTCODE=SELECT trim(CODE_DTL.CODE_NO)||'_'||trim(CODE_DTL.CODE_DESC) as code_desc FROM CODE_DTL WHERE code_dtl.code_type = '23'
CASETYPE=SELECT trim(code_dtl.code_no)||'_'||trim(code_dtl.code_desc) as code_desc FROM code_dtl WHERE code_dtl.code_type = '42' and code_no in ('02','12','B6','B8','HN')

AMIEKG=select * FROM rcvd_view WHERE Ptn_id = $CHR_NO$ AND Modality ='ECG' AND Study_date >= $STDATE$ AND Study_date <= $ENDATE$

#IPDBEDCHK=(SELECT Decode(COUNT( * ), '0', '', 'Y') FROM Besp_Reserve WHERE Besp_Reserve.Cncl_Flag = 'N' AND TRIM(Besp_Reserve.Besp_Status) = '1' and Fee_No = a.fee_no)

HRRSTR=,(case when (SELECT COUNT(*) FROM LAB JOIN LAB_DTL ON LAB.EXAM_NO = LAB_DTL.EXAM_NO AND LAB.WRITE_TIME = LAB_DTL.WRITE_TIME WHERE CHR_NO = A.CHR_NO AND LAB.REPORT_DATE = A.OPD_DATE AND LAB_DTL.DANGEROUS_FLAG IN ('T','E')) >= 1 THEN 'Y' WHEN (SELECT COUNT(*) FROM PATT_RISK_WFH2 WHERE CHR_NO = A.CHR_NO AND REPORT_DATE = A.OPD_DATE )>= 1 THEN 'Y' WHEN (SELECT COUNT(*) FROM RADIO WHERE CHR_NO = A.CHR_NO AND REPORT_DATE = A.OPD_DATE) >= 1 THEN 'Y' ELSE 'N' end) as HAS_HRR 

CONTROLLED_DRUGS_PRINT=SELECT A.* FROM OPD_MED A,MED_BASIC B WHERE A.OPD_DATE=$EPDDATE$ AND A.FEE_NO=$FEE_NO$ AND sheet_no=$SHEETNO$ AND A.MED_CODE=B.MED_CODE AND B.MGMT_TYPE ='T' AND B.CURR_TYPE_I = '1' 
CONTROLLED_DRUGS_PRINT_ALL=SELECT A.* FROM OPD_MED A,MED_BASIC B WHERE A.OPD_DATE=$EPDDATE$ AND A.FEE_NO=$FEE_NO$ AND A.MED_CODE=B.MED_CODE AND B.MGMT_TYPE ='T' AND B.CURR_TYPE_I = '1' 

COST=SELECT DECODE(TYPE,'A','追蹤會診','B','追蹤回覆','2','營養會診','3','TPN','4','TPN','5','社工會診','新會診') AS 會診類型,C.CHR_NO 病歷號,(SELECT PAT_NAME FROM CHR_BASIC I WHERE I.CHR_NO=C.CHR_NO) AS 病人姓名,(SELECT TRIM(EMPLOYE_NO)||'_'||TRIM(EMPLOYE_NAME) FROM EMP WHERE EMPLOYE_NO= C.DOC_CODE) AS 主治醫師,(SELECT C.DEPT_CODE||'_'||TRIM(COST_DESC) FROM COST_BASIC WHERE COST_CODE=C.DEPT_CODE) AS 開單科別,C.BEGINDATE 開單日期,C.BEGINTIME 時間,(SELECT BED_NO FROM IPD_BASIC I WHERE I.FEE_NO=C.FEE_NO) AS 床號,(SELECT TRIM(EMPLOYE_NO)||'_'||TRIM(EMPLOYE_NAME) FROM EMP WHERE EMPLOYE_NO=RECOSDOC) AS 被會診醫師,(SELECT C.RECOSDEPT||'_'||TRIM(COST_DESC) FROM COST_BASIC WHERE COST_CODE=C.RECOSDEPT) AS 被會診科別,DECODE(COS_FLAG,'0','開立暫存','1','已開立','2','回覆暫存','3', NVL((SELECT DECODE(FOLLOW_FLAG,'Y','追蹤備忘','回覆完成') FROM COS_CHECK H WHERE H.COS_NO=C.COS_NO),'回覆完成')) AS 狀態, 
COST1=C.FEE_NO AS 序號 FROM COSBASIC C WHERE C.CANCD='N' AND COS_FLAG IN ('1','2') AND EXISTS (SELECT FEE_NO FROM IPD_BASIC I WHERE IPD_FLAG='Y' AND C.FEE_NO=I.FEE_NO UNION SELECT FEE_NO FROM EPD_HIS I WHERE END_DATE = '9999999' AND LPAD(TRIM(I.EPD_DATE),7,'0') >='1020208' AND I.FEE_NO=C.FEE_NO) AND ((RECOSDOC ='$+USERID+$') OR ( RECOSDEPT IN ('$+USERDEPT+$')) or RECOSDEPT in (Select cossec as dept_code from cosdr where DOC_KIND='3' And dr_id ='$+USERID+$')) ORDER BY LPAD(TRIM(BEGINDATE),7,'0') DESC,BEGINTIME DESC

#COST=SELECT Epd_His.Fee_No,  Pkutility.f_Format_Datetime(To_Char(To_Number(To_Char(To_Date(To_Char(To_Number(Ipd_Consult.Odr_Date) +19110000) ||Ipd_Consult.Odr_Time,'YYYYMMDDHH24MI') + (1 /To_Number(Decode(Ipd_Consult.Urg_Flag,'1','1','3','2','4','0.5','5','2','6','1',Ipd_Consult.Urg_Flag))),'YYYYMMDDHH24MI')) - 191100000000)) "到期時間",  Epd_His.Chr_No "病歷號",  Epd_His.Pat_Name "姓名",  Decode(Epd_His.Sex_Type, '0', '女', '男') "性別",  Vs_Doc.Doc_Name "主治",  Epd_His.Bed_No "床號",  Ipd_Consult.Cons_Times "會診次數",  Decode(Ipd_Consult.Cons_Type, '2', '一般', '1', '專科') "會診方式",  Dept_Basic.Smpl_Desc "會診科",  Cons_Doc.Doc_Name "會診醫師", Pkutility.f_Format_Datetime(Rtrim(Ipd_Consult.Odr_Date) || Rtrim(Ipd_Consult.Odr_Time)) AS "會診開立時間",  Pkutility.f_Format_Datetime(Rtrim(Ipd_Consult.Cons_Date) || Rtrim(Ipd_Consult.Cons_Time)) AS "會診登入時間",  Code_Dtl.Code_Desc "會診類型",  Ipd_Consult.Ok_Flag "已回覆",  Ipd_Consult.Ins_Flag "健保",  Epd_His.Fee_No "批價序號"  
#COST1= FROM Epd_His,  Ipd_Consult,  Dept_Basic,  Doc_Basic Vs_Doc,  Doc_Basic Cons_Doc,  Code_Dtl  WHERE Epd_Status BETWEEN '0' AND '2'  AND Ipd_Consult.Fee_No = Epd_His.Fee_No  AND Ipd_Consult.Del_Flag <> 'Y'  AND Ipd_Consult.Cons_Doc = $+USERID+$  AND Ipd_Consult.Cons_Doc = Cons_Doc.Doc_Code(+)  AND Epd_His.Doc_Code = Vs_Doc.Doc_Code(+)  AND Code_Dtl.Code_Type = 'CN'  AND Ipd_Consult.Urg_Flag = Code_Dtl.Code_No(+)  AND Ipd_Consult.Cons_Dept = Dept_Basic.Dept_Code  ORDER BY Epd_His.Fee_No, Ipd_Consult.Cons_Times 